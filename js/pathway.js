function ready(e,t,r){pathwayW=parseInt(d3.select(".container").style("width")),graph={nodes:[],links:[]},t.forEach(function(e){graph.nodes.push({id:e.source_id,name:e.source,level:e.level}),graph.links.push({source:e.source,source_id:e.source_id,target:e.target,target_id:e.target_id,value:e.value})});var n=d3.nest().key(function(e){return e.name}),a=n.entries(graph.nodes);graph.nodes=a.map(function(e){return e.values[0]}),graph.links.forEach(function(e,t){graph.links[t].source=graph.nodes.map(function(e,r){return e.name==graph.links[t].source?r:void 0}).filter(isFinite)[0],graph.links[t].target=graph.nodes.map(function(e,r){return e.name==graph.links[t].target?r:void 0}).filter(isFinite)[0]}),graph.nodes.forEach(function(e,t){graph.nodes[t]={id:e.id,name:e.name,level:e.level}});for(var o,s=0;s<levels.length;s++){o=graph.nodes.filter(function(e){return e.level==levels[s]});for(var l=0;l<o.length;l++)o[l].levelIndex=l,o[l].levelLength=o.length}jobsDataset=d3.nest().key(function(e){return e.id}).entries(r),draw()}function draw(){nodes=graph.nodes,links=graph.links;var e,t,r,n=(d3.select(".pathway").append("div").attr("class","tooltip"),d3.select(".pathway").node().getBoundingClientRect()),a={top:60,right:.1*n.width,bottom:15,left:.1*n.width};pathwayW>550?a.top=a.top:a.top=20,pathwayW>550?a.left=a.left:a.left=0,pathwayW>550?a.right=a.right:a.right=50,r=pathwayW>685?47:15,e=n.width-a.left-a.right,t=pathwayW>550?.75*n.width-a.top-a.bottom:1.1*n.width-a.top-a.bottom;for(var o=d3.scale.ordinal().domain(levels).rangeRoundPoints([40,e]),s=(d3.scale.sqrt().domain(d3.extent(jobsDataset.map(function(e){return+e.values[0].job_openings}))).range([t/10,t/7]),0);s<nodes.length;s++)nodes[s].fixed=!0,nodes[s].x=o(nodes[s].level),nodes[s].y=nodes[s].levelIndex*(t/nodes[s].levelLength)+t/2/nodes[s].levelLength;var l=d3.svg.diagonal().projection(function(e){return[e.y,e.x]}),i=d3.select(".pathway").append("svg").attr("width",e+a.left+a.right).attr("height",t+a.top+a.bottom);i.append("rect").attr("width",e+a.left+a.right).attr("height",t+a.top+a.bottom).attr("class","backGrndClick").style("z-index",-100).style("fill","#fff").on("click",unclick),i.append("rect").attr("width",function(){return pathwayW>550?150:80}).attr("height",function(){return pathwayW>550?t+30:t+15}).attr("y",function(){return pathwayW>550?40:20}).attr("x",function(){return pathwayW>550?65:0}).attr("class","backgr").attr("rx",6).attr("ry",6).style("z-index",-100).style("fill","#fff").style("stroke","#CFD8DC");var c=i.append("g").attr("transform","translate("+a.left+","+a.top+")").selectAll(".levLines").data(levels),d=c.enter().append("g");d.append("line").attr("x1",function(e){return o(e)}).attr("y1",0).attr("x2",function(e){return o(e)}).attr("y2",t).style("stroke","#eaeaea"),d.append("text").attr("class","levLab").attr("x",function(e){return o(e)}).attr("y",-5).attr("text-anchor","middle").text(function(e){return"Feeder"!==e?e:"Feeder Role"}),i.append("defs").append("marker").attr("id","marker").attr("class","mark").attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",10).attr("markerHeight",10).attr("orient","auto").append("path").attr("fill","#546e7a").attr("d","M0,-5L10,0L0,5");var p=d3.selectAll(".levLab"),y=p[0][0].getBBox(),u=p[0][1].getBBox(),f=p[0][2].getBBox(),h=p[0][3].getBBox(),g=.03*e,x=y.x+y.width,m=u.x,k=u.x+u.width,v=f.x,b=f.x+f.width,w=h.x,A=i.append("g").attr("transform","translate("+a.left+","+a.top+")").attr("class","arrows");A.append("line").attr("x1",x+3*g).attr("y1",y.y+9).attr("x2",m-g).attr("y2",y.y+9).style("stroke","#eaeaea").attr("marker-end","url(#marker)"),A.append("line").attr("x1",k+g).attr("y1",y.y+9).attr("x2",v-g).attr("y2",y.y+9).style("stroke","#eaeaea").attr("marker-end","url(#marker)"),A.append("line").attr("x1",b+g).attr("y1",y.y+9).attr("x2",w-g).attr("y2",y.y+9).style("stroke","#eaeaea").attr("marker-end","url(#marker)");var $=i.append("g").attr("transform","translate("+a.left+","+a.top+")").selectAll("path").data(links);$.enter().append("path").attr("class","link backLink").attr("d",function(e){if("f"!==e.source_id.charAt(0)){if(e.source_id.charAt(0)==e.target_id.charAt(0)){var t=(jobsDataset.filter(function(t){return t.key==e.source_id}),jobsDataset.filter(function(t){return t.key==e.target_id}),2*Math.PI*r*.25-8),n=2*Math.PI*r*.25-8,a=nodes[e.target].x-nodes[e.source].x,o=nodes[e.target].y-nodes[e.source].y,s=Math.sqrt(.4*(a*a+o*o));return nodes[e.source].y>nodes[e.target].y?"M"+(nodes[e.source].x-n/2)+","+(nodes[e.source].y-n/2)+"A"+s+","+s+" 0 0,1 "+(nodes[e.target].x-t/2)+","+(nodes[e.target].y+t/2):"M"+(nodes[e.source].x+n/2)+","+(nodes[e.source].y+n/2)+"A"+s+","+s+" 0 0,1 "+(nodes[e.target].x+t/2)+","+(nodes[e.target].y-t/2)}var i=(jobsDataset.filter(function(t){return t.key==e.source_id}),jobsDataset.filter(function(t){return t.key==e.target_id}),{x:nodes[e.source].y,y:nodes[e.source].x+r}),c={x:nodes[e.target].y,y:nodes[e.target].x-r};return l({source:i,target:c})}}).style("display","none");var C=($.enter().append("path").attr("class","link frontLink").attr("marker-end","url(#marker)").attr("d",function(e){if("f"!==e.source_id.charAt(0)){if(e.source_id.charAt(0)==e.target_id.charAt(0)){var t=(jobsDataset.filter(function(t){return t.key==e.source_id}),jobsDataset.filter(function(t){return t.key==e.target_id}),2*Math.PI*r*.25-8),n=2*Math.PI*r*.25-8,a=nodes[e.target].x-nodes[e.source].x,o=nodes[e.target].y-nodes[e.source].y,s=Math.sqrt(.4*(a*a+o*o));return nodes[e.source].y>nodes[e.target].y?"M"+(nodes[e.source].x-n/2)+","+(nodes[e.source].y-n/2)+"A"+s+","+s+" 0 0,1 "+(nodes[e.target].x-t/2)+","+(nodes[e.target].y+t/2):"M"+(nodes[e.source].x+n/2)+","+(nodes[e.source].y+n/2)+"A"+s+","+s+" 0 0,1 "+(nodes[e.target].x+t/2)+","+(nodes[e.target].y-t/2)}var i=(jobsDataset.filter(function(t){return t.key==e.source_id}),jobsDataset.filter(function(t){return t.key==e.target_id}),{x:nodes[e.source].y,y:nodes[e.source].x+r}),c={x:nodes[e.target].y,y:nodes[e.target].x-r};return l({source:i,target:c})}}).style("display","none"),i.append("g").attr("transform","translate("+a.left+","+a.top+")")),_=C.selectAll("g").data(nodes).enter().append("g").attr("class","circleCont");_.append("circle").attr("class","jobRoles").attr("id",function(e){return e.id}).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",function(){return r}).on("mouseover",function(e){highlightSelection(e,this),showToolTip(e,this)}).on("mouseout",function(){d3.selectAll(".circleCont").select("text").style("opacity",1),d3.selectAll(".jobRoles").style("stroke","#29B6F6").style("stroke-width","2px").style("fill","#f7f8f9"),d3.selectAll(".link").style("display","none"),d3.select(".tooltip").style("display","none")}).on("click",function(e,t){1==clicked&&e.id==clickedId?unclick():clickHandler(e,t,this)});_.append("text").attr("x",function(e){return e.x}).attr("y",function(e){return e.y}).attr("dy",".35em").style("text-anchor","middle").text(function(e){return e.name}).call(wrap,80);d3.selectAll(".circleCont").selectAll("tspan").attr("y",function(e){var t=d3.select(this.parentNode).selectAll("tspan");return 1==t[0].length?pathwayW>685?e.y:e.y+25:2==t[0].length?pathwayW>685?e.y-5:e.y+25:3==t[0].length?pathwayW>685?e.y-13:e.y+25:e.y-18}),i.append("text").attr("class","rolesType").text("Common Cybersecurity Feeder Roles").attr("y",13).attr("x",function(){return o("Feeder")+25}).attr("dy",".35em").style("font-weight",600).attr("text-anchor","start").call(wrap,140);var B=i.append("g").attr("class","feederBlock").style("display","none").style("opacity",0);i.append("image").attr("class","infIcon labelsInf").attr("width","17px").attr("height","15px").attr("xlink:href","./images/i_03.png").attr("id","feederInf").attr("y",19).attr("x",143).on("mouseover",function(){d3.select(".feederBlock").style("display","block").transition().duration(250).style("opacity",1),d3.select(".rolesInfoBG").transition().duration(250).style("display","block")}).on("mouseout",function(){d3.select(".feederBlock").transition().duration(250).style("opacity",0).style("display","block").each("end",function(){d3.select(".rolesInfoBG").transition().duration(250).style("display","none")})}),B.append("rect").attr("class","rolesInfoBG").attr("y",38).attr("x",function(){return o("Feeder")+25}).attr("width",160).attr("height",260).style("fill","#eceff1"),B.append("text").attr("class","rolesInfo").text("Common cybersecurity feeder roles are career areas that are most likely to serve as stepping stones into a career in cybersecurity. Many career areas may prepare workers for jobs in cybersecurity, but common feeder roles were identified by analyzing similarities in skill requirements between jobs and pinpointing those jobs with significant skill overlap with multiple core cybersecurity roles.").attr("y",53).attr("x",function(){return o("Feeder")+33}).attr("dy",".35em").attr("text-anchor","start").style("font-size","12px").call(wrap,148),i.append("text").attr("class","rolesType").text("Core Cybersecurity Roles").attr("y",13).attr("x",function(){return o("Mid-Level")}).attr("dy",".35em").style("font-weight",600).attr("text-anchor","start"),i.append("image").attr("class","infIcon labelsInf").attr("width","17px").attr("height","15px").attr("xlink:href","./images/i_03.png").attr("id","coreInf").attr("y",5).attr("x",function(){return o("Mid-Level")+146}).on("mouseover",function(){d3.select(".coreBlock").style("display","block").transition().duration(250).style("opacity",1),d3.select(".coreInfoBG").transition().duration(250).style("display","block")}).on("mouseout",function(){d3.select(".coreBlock").transition().duration(250).style("opacity",0).style("display","block").each("end",function(){d3.select(".coreInfoBG").transition().duration(250).style("display","block")})});var I=i.append("g").attr("class","coreBlock").style("display","none").style("opacity",0);I.append("rect").attr("class","coreInfoBG").attr("y",28).attr("x",function(){return o("Mid-Level")-58}).attr("width",300).attr("height",100).style("fill","#eceff1"),I.append("text").attr("class","rolesInfo").text("Core cybersecurity roles are the most commonly requested job categories across the cybersecurity ecosystem.  They are classified as entry-level, mid-level, or advanced-level based upon the experience, education levels, and credentials requested by employers.").attr("y",43).attr("x",function(){return o("Mid-Level")-50}).attr("dy",".35em").attr("text-anchor","start").style("font-size","12px").call(wrap,290)}function clickHandler(e,t,r){$(".table").css("opacity",1),$(".table").slideDown("fast"),"Feeder"===e.level&&1==once?($(".no1").children().css("display","none"),$(".no1").append($(".no5").children()),d3.select("#no4").selectAll(".toChange").style("letter-spacing","-0.2px").html("TOP CYBERSECURITY SKILLS TO ADD"),d3.select("#no4").selectAll(".def").html("Shows the skills that workers in this feeder role will most likely need to develop to prepare for roles in cybersecurity."),$(".no5").append($("#no4").children()),$("#no4").append($("#no6").children()),$("#no6").css("display","none"),$("#c3 > .line").css("display","none"),$(".no5").addClass("long").css("border-left","1px solid #CFD8DC"),$(".no3").css("border-right","0px"),$("#c4").insertBefore($("#c3")),$(".no1").next().insertBefore($(".no1")),$("#no2").insertBefore($(".no1").prev()),$(".no1").css("margin-top","15px"),$("#no2").css({"margin-top":"0px","margin-bottom":"15px"}),$(".feeder").css("display","block"),$(".core").css("display","none"),once=!1):"Feeder"===e.level&&0==once||void 0!==$("#no2").next()[0]&&($(".no1").children().css("display","block"),$("#b1").css("display","none"),$("#b5").css("display","none"),$(".no3").css("border-right","1px solid #CFD8DC"),$("#c3 > .line").css("display","block"),$("#no6").append($("#no4").children()),$(".no5").removeClass("long").css("border-left","0px"),$("#no6").css("display","block"),$("#no4").append($(".no5").children()),$(".no5").append($("#b5"),$("#b5").next()),d3.select("#no4").selectAll(".toChange").style("letter-spacing","0px").html("COMMON NICE CYBERSECURITY WORKFORCE FRAMEWORK CATEGORIES"),d3.select("#no4").selectAll(".def").html("Shows common NICE Cybersecurity Workforce Framework Categories that map to a particular job. Within each Framework Category are Specialty Areas that correspond to on-the-job competencies that may be required of workers in a particular role"),$(".no1").insertBefore($("#no2")),$("#no2").next().insertBefore($("#no2")),$("#no2").css("margin-top","15px"),$(".no1").css({"margin-top":"0px","margin-bottom":"15px"}),$(".feeder").css("display","none"),$(".core").css("display","block"),$("#c3").insertBefore($("#c4")),once=!0),d3.select(".job").html(e.name),d3.selectAll(".link").style("display","none"),highlightSelection(e,r),d3.selectAll(".jobRoles").on("mouseover",null).on("mouseout",null),clicked=!0,clickedId=e.id,d3.select(".tooltip").style("display","none")}function highlightSelection(e,t){var r=e.id;d3.selectAll(".jobRoles").style("stroke","#d4f0fd").style("stroke-width","2px").style("fill","#f7f8f9"),d3.selectAll(".circleCont").select("text").style("opacity",.2);var n=d3.selectAll(".link").filter(function(e){return nodes[e.source].id==r}),a=d3.selectAll(".link").filter(function(e){return nodes[e.target].id==r}),o=d3.selectAll(".frontLink").filter(function(e){return nodes[e.source].id==r}),s=d3.selectAll(".frontLink").filter(function(e){return nodes[e.target].id==r});n.style("display","inherit"),a.style("display","inherit");for(var l=0;l<o[0].length;l++){var i=d3.select(o[0][l]),c=o[0][l].getTotalLength();i.attr("stroke-dasharray",c+" "+c).attr("stroke-dashoffset",c).transition().duration(250).ease("linear").attr("stroke-dashoffset",0),d3.selectAll(".circleCont").filter(function(e){return e.name==nodes[n[0][l].__data__.target].name}).select("text").style("opacity",1),d3.selectAll(".circleCont").filter(function(e){return e.name==nodes[n[0][l].__data__.target].name}).select("circle").style("stroke","#29B6F6")}for(var l=0;l<s[0].length;l++){var i=d3.select(s[0][l]),c=s[0][l].getTotalLength();i.attr("stroke-dasharray",c+" "+c).attr("stroke-dashoffset",c).transition().duration(250).ease("linear").attr("stroke-dashoffset",0),d3.selectAll(".circleCont").filter(function(e){return e.name==nodes[a[0][l].__data__.source].name}).select("text").style("opacity",1),d3.selectAll(".circleCont").filter(function(e){return e.name==nodes[a[0][l].__data__.source].name}).select("circle").style("stroke","#29B6F6")}d3.select(t.parentNode).select("text").style("opacity",1),d3.select(t).style("stroke","#455a64").style("stroke-width","3px").style("fill","#9addfb")}function unclick(){$(".table").slideUp("fast"),d3.select(".job").html(" "),d3.selectAll(".circleCont").select("text").style("opacity",1),d3.selectAll(".jobRoles").style("stroke","#29B6F6").style("stroke-width","2px").style("fill","#f7f8f9"),d3.selectAll(".link").style("display","none"),d3.selectAll(".circ").style("opacity",.5).style("stroke-width","0px"),d3.selectAll(".jobRoles").on("mouseover",function(e){highlightSelection(e,this),showToolTip(e,this)}).on("mouseout",function(){d3.selectAll(".circleCont").select("text").style("opacity",1),d3.selectAll(".link").style("display","none"),d3.selectAll(".jobRoles").style("stroke","#29B6F6").style("stroke-width","2px").style("fill","#f7f8f9"),d3.select(".tooltip").style("display","none")}),clicked=!1,clickedId=""}function showToolTip(e,t){var r=jobsDataset.filter(function(t){return t.key==e.id}),n="<div class='tipJob'>"+e.name+"</div><div class='var'>Job openings</div><div class='tipValue op'>"+formatThousand(r[0].values[0].job_openings)+"</div><div class='var'>Average salary</div><div class='tipValue sal'>$"+formatThousand(r[0].values[0].average_salary)+"</div><div class='more'>Click the circle for more info</div>";d3.select(".tooltip").html(n).style("display","inherit");var a=d3.select(".tooltip").node().getBoundingClientRect(),o=d3.select(".pathway").node().getBoundingClientRect();d3.select(".tooltip").style("top",e.y+65+ +d3.select(t).attr("r")+"px").style("left",e.x+.1*o.width-a.width/2+"px")}function getOffsetTop(e){var t=0;do isNaN(e.offsetTop)||(t+=e.offsetTop);while(e=e.offsetParent);return t}function setBoxHeight(){var e=document.getElementById("no4").offsetHeight;if(pathwayW>1e3&&pathwayW>575)document.getElementById("no2").style.height=e+"px",document.getElementById("no6").style.height=e+"px";else{if(575>=pathwayW)return;document.getElementById("no6").style.height=e+"px"}}function wrap(e,t){e.each(function(){for(var e,r=d3.select(this),n=r.text().split(/\s+/).reverse(),a=[],o=0,s=1.1,l=r.attr("y"),i=r.attr("x"),c=parseFloat(r.attr("dy")),d=r.text(null).append("tspan").attr("x",i).attr("y",l).attr("dy",c+"em");e=n.pop();)a.push(e),d.text(a.join(" ")),d.node().getComputedTextLength()>t&&(a.pop(),d.text(a.join(" ")),a=[e],d=r.append("tspan").attr("x",i).attr("y",l).attr("dy",++o*s+c+"em").text(e))})}function idStrip(e){var t=e.replace(/\s+/g,""),r=t.replace(/\.+/g,""),n=r.replace(/\'+/g,""),a=n.toLowerCase(),o=a.substring(0,20),s=o.replace(/\,+/g,""),l=s.replace(/\/+/g,""),i=l.replace(/\&+/g,""),c=i.replace(/\-/g,"");return c}var graph,levels=["Feeder","Entry-Level","Mid-Level","Advanced-Level"],jobsDataset,catsData,nodes,links,clicked=!1,clickedId,formatThousand=d3.format(",d"),pathwayW,once=!0;queue().defer(d3.csv,"data/career_pathway_links_data.csv").defer(d3.csv,"data/career_pathway_jobs_data.csv").await(ready),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)})};