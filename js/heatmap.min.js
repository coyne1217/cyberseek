function updateTable(t){d3.selectAll("circle.ratioCirc").style("opacity",.5).attr("stroke","none"),d3.selectAll(".ratioNumber").style("display","none"),d3.selectAll(".ratioState").style("display","none"),t.id?(d3.select(".region").html(t.properties.state),drawOpenings(t.id),d3.selectAll(".cirG").select("rect").style("display","none"),d3.select("#supply_demand_ratioSvg").select("#cf"+t.id).moveToFront().style("opacity",1).attr("stroke","#455A64").attr("stroke-width","2px"),d3.select("#supply_demand_ratioSvg").select("#tf"+t.id).style("display","block"),d3.select("#supply_demand_ratioSvg").select("#bg"+t.id).style("display","block"),d3.select("#supply_demand_ratioSvg").select("#tsf"+t.id).style("display","block"),d3.select("#location_quotientSvg").select("#cf"+t.id).moveToFront().style("opacity",1).attr("stroke","#455A64").attr("stroke-width","2px"),d3.select("#location_quotientSvg").select("#tf"+t.id).style("display","block"),d3.select("#location_quotientSvg").select("#bg"+t.id).style("display","block"),d3.select("#location_quotientSvg").select("#tsf"+t.id).style("display","block"),fillQuotient(t.id,"supply_demand_qualifier"),fillQuotient(t.id,"location_quotient_qualifier"),fillTopJobs(t.id),theTreeMap.updateTreemap(t.id),updateBars(t.id)):(d3.select(".region").html(t.properties.NAME),drawOpenings(t.properties.geoid),d3.selectAll(".cirG").select("rect").style("display","none"),d3.select("#supply_demand_ratioSvg").select("#cf"+t.properties.geoid).moveToFront().style("opacity",1).attr("stroke","#455A64").attr("stroke-width","2px"),d3.select("#supply_demand_ratioSvg").select("#tf"+t.properties.geoid).style("display","block"),d3.select("#supply_demand_ratioSvg").select("#bg"+t.properties.geoid).style("display","block"),d3.select("#supply_demand_ratioSvg").select("#tsf"+t.properties.geoid).style("display","block"),d3.select("#location_quotientSvg").select("#cf"+t.properties.geoid).moveToFront().style("opacity",1).attr("stroke","#455A64").attr("stroke-width","2px"),d3.select("#location_quotientSvg").select("#tf"+t.properties.geoid).style("display","block"),d3.select("#location_quotientSvg").select("#bg"+t.properties.geoid).style("display","block"),d3.select("#location_quotientSvg").select("#tsf"+t.properties.geoid).style("display","block"),fillQuotient(t.properties.geoid,"supply_demand_qualifier"),fillQuotient(t.properties.geoid,"location_quotient_qualifier"),fillTopJobs(t.properties.geoid),theTreeMap.updateTreemap(t.properties.geoid),updateBars(t.properties.geoid))}function init(t){function e(t,e,a){function i(t){"undefined"!=typeof s&&s.destroy(),s=new autoComplete({selector:"#search",minChars:0,source:function(e,a){e=e.toLowerCase();var i;i="states"==t?o:l;var s=[];for(c=0;c<i.length;c++)~i[c].toLowerCase().indexOf(e)&&s.push(i[c]);a(s)},onSelect:function(a,i){var s,r,n;"states"==t?(s=e.objects.states.geometries.filter(function(t){return t.properties.state==i}),r=d3.select("#fips_"+s[0].id)[0][0].__data__,n=document.getElementById("fips_"+s[0].id)):(s=csvData.filter(function(t){return t.msa==i}),n=document.getElementById("fips_"+s[0].fips),r=d3.select("#fips_"+s[0].fips)[0][0].__data__),updateTable(r),theMap.clicked(r,n)}})}mapW=parseInt(d3.select(".map").style("width")),csvData=a,csvData.forEach(function(t){t.fips.toString().length<3&&0!=t.fips?rateByStateId.set(+t.fips,+t.total_postings):t.fips.toString().length>3&&0!=t.fips&&rateByMsaId.set(+t.fips,+t.total_postings)}),dataset=d3.nest().key(function(t){return t.fips}).map(csvData),csvData.forEach(function(t){"0"!==t.fips&&(postingsArr.push(+t.total_postings),postingsArr.push(+t.total_supply))}),theTreeMap=new treeMap({element:document.querySelector(".treemap"),fips:0,treeMapData:{name:"Postings by NICE Framework Area",children:[{defs:"Specialty Areas responsible for providing the support, administration, and maintenance necessary to ensure effective and efficient information technology (IT) system performance and security.",name:"Operate & Maintain",size:+dataset[0][0].operate_maintain},{defs:"Specialty Areas responsible for conceptualizing, designing, and building secure information technology (IT) systems, with responsibility for some aspect of the systems' development.",name:"Securely Provision",size:+dataset[0][0].securely_provision},{defs:"Specialty Areas responsible for providing leadership, management, direction, or development and advocacy so the organization may effectively conduct cybersecurity work.",name:"Oversee & Govern",size:+dataset[0][0].oversight_development},{defs:"Specialty Areas responsible for specialized denial and deception operations and collection of cybersecurity information that may be used to develop intelligence.",name:"Collect & Operate",size:+dataset[0][0].collect_operate},{defs:"Specialty Areas responsible for highly specialized review and evaluation of incoming cybersecurity information to determine its usefulness for intelligence.",name:"Analyze",size:+dataset[0][0].analyze},{defs:"Specialty Areas responsible for identifying, analyzing, and mitigating threats to internal information technology (IT) systems or networks.",name:"Protect & Defend",size:+dataset[0][0].protect_defend},{defs:"Specialty Areas responsible for investigating cyber events or crimes related to information technology (IT) systems, networks, and digital evidence.",name:"Investigate",size:+dataset[0][0].investigate}]}}),theMap=new heatMap({element:document.querySelector(".map"),geo:e,view:"states"});var s;d3.selectAll("input.geo").on("click",function(){theMap.view=d3.select(this).attr("val"),theMap.setView(),choices=d3.select(this).attr("val"),i(choices)}),d3.select(".map").on("click",function(){document.getElementById("search").value=""}),d3.select(window).on("resize",function(){theMap.update(),mapW=parseInt(d3.select(".map").style("width")),600>mapW?(d3.select(".leg").remove(),drawLegend(),d3.select(".instruction").remove()):mapW>600&&(d3.select(".leg").remove(),drawLegend())}),d3.selectAll(".feature").attr("fill",function(t){return t.id?(quantile.domain(rateByStateId.values()),quantile(rateByStateId.get(t.id))):"undefined"!=typeof t.properties?(quantile.domain(rateByMsaId.values()),quantile(rateByMsaId.get(t.properties.geoid))):"#fff"}),theMap.svg.append("text").attr("class","instruction").attr("x",theMap.width/1.75).attr("y",.08*theMap.height).text(function(){return mapW>600?"Click on a state or MSA for more info":""}),drawLegend(),drawOpenings(0),drawRatioChart("supply_demand_ratio",".no2"),drawRatioChart("location_quotient",".no3"),drawQualifier(["#5586bd","#7fa7cf","#fef0d9","#d75231","#990000"],"supply_demand_qualifier"),drawQualifier(colorbrewer.BuPu[5],"location_quotient_qualifier"),fillTopJobs(0),createBars(),updateBars(0),i("states"),theMap.setView();var r=document.getElementById("prelC");r.style.display="none";var n=document.getElementById("con");n.style.opacity="1";var o=[],l=[],d=[];csvData.forEach(function(t){"0"!==t.fips&&t.fips.toString().length<3&&d.push(t.fips),"0"!==t.fips&&""!=t.msa&&l.push(t.msa)});for(var c=0;c<d.length;c++){var p=e.objects.states.geometries.filter(function(t){return t.id==d[c]});-1==o.indexOf(p[0].properties.state)&&o.push(p[0].properties.state)}new ShareButton({networks:{email:{enabled:!1}}});var u=document.getElementById("drpdn");u.onchange=function(){var t=u.options[u.selectedIndex].value;selectedVar=t,theMap.reDraw()};d3.selectAll(".filter").on("click",function(){1==d3.select("#all").classed("pressed")?d3.selectAll(".msa").style("display","none"):"","All"!=d3.select(this).text()?d3.select(this).classed("pressed")?(d3.select(this).classed("pressed",!1),d3.selectAll("."+d3.select(this).text().toLowerCase()).style("display","none")):(d3.select("#all").classed("pressed",!1),d3.select(this).classed("pressed",!0),d3.selectAll("."+d3.select(this).text().toLowerCase()).style("display","block")):(d3.selectAll(".filter").classed("pressed",!1),d3.select("#all").classed("pressed",!0),d3.selectAll(".msa").style("display","block"))}),d3.selectAll(".infIcon").on("click",function(){d3.select("#b"+d3.select(this).attr("rel")).style("display","block")}),d3.selectAll(".closeBtn").on("click",function(){d3.select("#b"+d3.select(this).attr("rel")).style("display","none")})}rateByStateId=d3.map(),rateByMsaId=d3.map(),quantile=d3.scale.quantile().range(colorbrewer.PuBu[7]),queue().defer(d3.json,"data/us_states_msa.json").defer(d3.csv,"data/"+t+".csv").await(e),console.log(t)}function setLegendLabel(t,e){var a=[0,.67,.83,1.2,1.5,8];if("states"==theMap.view){var i=rateByStateId.values().filter(isBigEnough(1.01));quantile.domain(i);var s=[0,.5,.99,1,quantile.invertExtent(quantile.range()[4])[0],quantile.invertExtent(quantile.range()[5])[0],quantile.invertExtent(quantile.range()[6])[1]];"location_quotient"==selectedVar?quantile.domain(a):"supply_demand_ratio"==selectedVar?quantile.domain(s):quantile.domain(rateByStateId.values());var r=quantile.invertExtent(t),n=d3.format(",.0f"),o=d3.format("s"),l=d3.format(".3n"),d=d3.format(".2n"),c=d3.format("");return"total_postings"==selectedVar||"total_supply"==selectedVar?mapW>600?0!=e?n(+r[0]+1)+" - "+n(+r[1]):n(+r[0])+" - "+n(+r[1]):0!=e?o(100*Math.round(+r[0]/100)):"":"location_quotient"==selectedVar?mapW>600?4!=e?0!=e?c(+r[0]+.01)+" - "+c(+r[1]):c(+r[0])+" - "+c(+r[1]):c(+r[0]+.01)+" + ":0!=e?c(+r[0]):"":mapW>600?0!=e?l(+r[0]+.05)+" - "+l(+r[1]):l(+r[0])+" - "+l(+r[1]):0!=e?d(+r[0]+.05):""}var i=rateByMsaId.values().filter(isBigEnough(1.01));quantile.domain(i);var s=[0,.5,.99,1,quantile.invertExtent(quantile.range()[4])[0],quantile.invertExtent(quantile.range()[5])[0],quantile.invertExtent(quantile.range()[6])[1]];"location_quotient"==selectedVar?quantile.domain(a):"supply_demand_ratio"==selectedVar?quantile.domain(s):quantile.domain(rateByMsaId.values());var r=quantile.invertExtent(t),n=d3.format(",.0f"),l=d3.format(".3n"),o=d3.format("s"),d=d3.format(".2n"),c=d3.format("");return"total_postings"==selectedVar||"total_supply"==selectedVar?mapW>600?0!=e?n(+r[0]+1)+" - "+n(+r[1]):n(+r[0])+" - "+n(+r[1]):0!=e?o(Math.round(+r[0])):"":"location_quotient"==selectedVar?mapW>600?4!=e?0!=e?c(+r[0]+.01)+" - "+c(+r[1]):c(+r[0])+" - "+c(+r[1]):c(+r[0]+.01)+" + ":0!=e?c(+r[0]):"":mapW>600?0!=e?l(+r[0]+.05)+" - "+l(+r[1]):l(+r[0])+" - "+l(+r[1]):0!=e?d(+r[0]+.05):""}function drawOpenings(t){var e=d3.scale.linear().domain([0,d3.max(postingsArr)]).range(["1%","100%"]);0==t&&(e=d3.scale.linear().domain([0,Math.max(dataset[t][0].total_postings,dataset[t][0].total_supply)]).range(["0%","100%"])),d3.select(".openingsNumber").html(formatThousand(dataset[t][0].total_postings)),d3.select(".supplyNumber").html(formatThousand(dataset[t][0].total_supply)),d3.select(".openingsBar").transition().styleTween("width",function(){var a=this.style.width,i=e(dataset[t][0].total_postings);return d3.interpolateString(a,i)}),d3.select(".supplyBar").transition().styleTween("width",function(){var a=this.style.width,i=e(dataset[t][0].total_supply);return d3.interpolateString(a,i)})}function drawRatioChart(t,e){var a=d3.map(),i=d3.map(),s=d3.map(),r=d3.map();csvData.forEach(function(e){e.fips.toString().length<3?(a.set(+e.fips,+e[t]),s.set(+e.fips,+e[t])):e.fips.toString().length>3&&(i.set(+e.fips,+e[t]),r.set(+e.fips,+e[t]))});var n=[],o=[];csvData.forEach(function(e){var a={};a.fips=+e.fips,a.ratio=+e[t],a.state=e.state,a.msa=e.msa,0==a.fips?o.push(a):n.push(a)});var l={top:0,right:10,bottom:0,left:0},d=d3.select(e).select(".boxContent").node().getBoundingClientRect().width-(l.left+l.right),c=150,p=d3.scale.log().range([20,d-20]),u=d3.scale.log().range([20,d-20]),f=n.filter(function(t){return""!=t.msa&&""!=t.ratio}),h=n.filter(function(t){return""!=t.state&&""!=t.ratio});"supply_demand_ratio"==t?(p.domain(d3.extent(h,function(t){return t.ratio})),u.domain(d3.extent(f,function(t){return t.ratio})),storedCxStSd=p,storedCxMsaSd=u):(p.domain(d3.extent(h,function(t){return t.ratio})),u.domain(d3.extent(f,function(t){return t.ratio})),storedCxStLq=p,storedCxMsaLq=u);var g=d3.select("#"+t+"Chart").append("svg").attr("id",t+"Svg").attr("width",d).attr("height",c);g.append("line").style("stroke","#CFD8DC").attr("x1",0).attr("y1",60).attr("x2",d).attr("y2",60);g.selectAll("."+t+"_average").data(o).enter().append("line").attr("class","avLine").attr("x1",function(t){return t.fips.toString().length>3?u(t.ratio):p(t.ratio)}).attr("x2",function(t){return t.fips.toString().length>3?u(t.ratio):p(t.ratio)}).attr("y1",30).attr("y2",90).attr("stroke","#b2c0c6");g.selectAll("."+t+"_averTxt").data(o).enter().append("text").attr("class","avTxt").attr("x",function(t){return t.fips.toString().length>3?u(t.ratio):p(t.ratio)}).attr("y",105).attr("class","averState").attr("text-anchor","middle").text("National average"),g.selectAll("."+t+"_averNum").data(o).enter().append("text").attr("class","avNum").attr("x",function(t){return t.fips.toString().length>3?u(t.ratio):p(t.ratio)}).attr("y",133).attr("class","averNumber").attr("text-anchor","middle").text(function(t){return formatDecimal2(t.ratio)});var m=(g.selectAll("circles").data(n).enter().append("circle").attr("id",function(t){return"cf"+t.fips}).attr("class",function(e){return e.fips.toString().length>3?t+" ratioCirc coun":t+" ratioCirc st"}).attr("cy",60).attr("r",15).attr("cx",function(t){return 0!=t.ratio?t.fips.toString().length>3?u(t.ratio):p(t.ratio):-1e3}).attr("fill",function(e){var n=[0,.67,.83,1.2,1.5,8],o=d3.scale.quantile().range(colorbrewer.BuPu[5]),l=d3.scale.quantile().range(["#2166ac","#5586bd","#7fa7cf","#fef0d9","#faa078","#d75231","#990000"]);if("supply_demand_ratio"==t){if(e.fips.toString().length<3){var d=s.values().filter(isBigEnough(1.01));l.domain(d);var c=[0,.5,.99,1,l.invertExtent(l.range()[4])[0],l.invertExtent(l.range()[5])[0],l.invertExtent(l.range()[6])[1]];return l.domain(c),l(s.get(e.fips))}var d=r.values().filter(isBigEnough(1.01));l.domain(d);var c=[0,.5,.99,1,l.invertExtent(l.range()[4])[0],l.invertExtent(l.range()[5])[0],l.invertExtent(l.range()[6])[1]];return l.domain(c),l(r.get(e.fips))}return e.fips.toString().length<3?(o.domain(n),o(a.get(e.fips))):(o.domain(n),o(i.get(e.fips)))}).on("mouseover",function(e){d3.select("#"+t+"Svg").selectAll("circle").style("fill","#eaeaea"),d3.select(this).moveToFront().attr("stroke","#455A64").attr("fill",d3.select(this).attr("fill")).style("fill","").attr("stroke-width","2px").style("opacity",1),d3.select("#"+t+"Svg").select("#tf"+e.fips).moveToFront().style("display","block"),d3.select("#"+t+"Svg").select("#bg"+e.fips).style("display","block"),d3.select("#"+t+"Svg").select("#tsf"+e.fips).moveToFront().style("display","block"),d3.select("path#fips_"+e.fips).classed("active",!0).moveToFront(),d3.select("#"+t+"Svg").select("#tf"+clickedId).style("display","none"),d3.select("#"+t+"Svg").select("#bg"+clickedId).style("display","none"),d3.select("#"+t+"Svg").select("#tsf"+clickedId).style("display","none")}).on("mouseout",function(e){d3.select("#"+t+"Svg").selectAll("circle").style("fill",""),d3.selectAll(".feature").classed("active",!1),d3.select("path#fips_"+clickedId).classed("active",!0).moveToFront(),d3.select(this).moveToBack().attr("stroke","none").style("opacity",.5),d3.select("#"+t+"Svg").select("#tf"+e.fips).style("display","none"),d3.select("#"+t+"Svg").select("#bg"+e.fips).style("display","none"),d3.select("#"+t+"Svg").select("#tsf"+e.fips).style("display","none"),d3.select("#"+t+"Svg").select("#cf"+clickedId).moveToFront().style("opacity",1).attr("stroke","#455A64").attr("stroke-width","2px"),d3.select("#"+t+"Svg").select("#tf"+clickedId).style("display","block"),d3.select("#"+t+"Svg").select("#bg"+clickedId).style("display","block"),d3.select("#"+t+"Svg").select("#tsf"+clickedId).style("display","block")}).on("click",function(e){theMap.tooltipDiv.style("display","none");var a=d3.select("path#fips_"+e.fips)[0][0],i=a.__data__;updateTable(i),theMap.clicked(i,a),selectedVar=t,document.getElementById("drpdn").value=selectedVar,theMap.reDraw()}),g.selectAll("nums").data(n).enter().append("g").attr("class","cirG"));m.append("rect").attr("id",function(t){return"bg"+t.fips}).attr("width",50).attr("height",42).style("fill","#fff").attr("x",function(t){return 0!=t.ratio?t.fips.toString().length>3?u(t.ratio)-25:p(t.ratio)-25:-1e3}).attr("y",0).style("display","none"),m.append("text").text(function(t){return formatDecimal(t.ratio)}).attr("id",function(t){return"tf"+t.fips}).attr("class","ratioNumber").attr("x",function(t){return 0!=t.ratio?t.fips.toString().length>3?u(t.ratio):p(t.ratio):-1e3}).attr("y",40).attr("text-anchor",function(){var t=d3.select(this).node().getBBox();return t.x+t.width/2>=d-5?"end":t.x-t.width/2<=10?"start":"middle"}).style("display","none"),m.append("text").text(function(t){return t.fips.toString().length<3?t.state:t.msa}).attr("id",function(t){return"tsf"+t.fips}).attr("class","ratioState").attr("x",function(t){return 0!=t.ratio?t.fips.toString().length>3?u(t.ratio):p(t.ratio):-1e3}).attr("y",15).attr("text-anchor",function(){var t=d3.select(this).node().getBBox();return t.x+t.width/2>=d-5?"end":t.x-t.width/2<=10?"start":"middle"}).style("display","none"),d3.select("#cf0").moveToFront().style("opacity",1).attr("stroke","#455A64").attr("stroke-width","2px"),d3.select("#tf0").style("display","block"),d3.select("#tsf0").style("display","block")}function drawQualifier(t,e){var a={top:10,right:0,bottom:0,left:0},i=d3.select("."+e).node().getBoundingClientRect().width-(a.left+a.right),s=35,r=d3.select("."+e).append("div").attr("id",e+"QualifierSvg").style("width",i+"px").style("height",s+"px");r.append("div").attr("class","qualText").html(dataset[0][0][e])}function fillQuotient(t,e){d3.select("."+e).selectAll(".qualifiers").style("opacity",.1);var a=d3.select("."+e).selectAll(".qualifiers")[0][qualifierData.indexOf(dataset[t][0][e])];d3.select(a).style("opacity",1),d3.select("."+e).select(".qualText").html(dataset[t][0][e])}function fillTopJobs(t){for(var e=[],a=1;10>a;a++)dataset[t][0]["top_job_"+a].length>2&&e.push(dataset[t][0]["top_job_"+a]);d3.select("#topJobsList").selectAll("li").remove(),d3.select("#topJobsList").selectAll("li").data(e).enter().append("li").html(function(t){return t})}function createBars(){barHeight=9,gapBetweenGroups=70,margin={top:20,right:70,bottom:0,left:140},width=d3.select(".no6").select(".boxContent").node().getBoundingClientRect().width-(margin.left+margin.right),height=460-margin.top-margin.bottom,color=d3.scale.linear().domain([0,1]).range(["#f46d43","#74add1"]),x=d3.scale.linear().range([0,width]),y=d3.scale.ordinal().rangeRoundBands([0,height-80+gapBetweenGroups],.1),yAxis=d3.svg.axis().scale(y).tickFormat("").tickSize(0).orient("left"),barSvg=d3.select(".no6").select(".barChart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),barSvg.append("text").attr("class","ratioLab").attr("y",20).attr("x",width+margin.right/2+margin.left).attr("text-anchor","middle").text("RATIO"),barSvg.append("g").attr("class","y axis").attr("transform","translate("+margin.left+", "+-gapBetweenGroups/2+")").call(yAxis),d3.select(".no6").select(".barChart").append("div").attr("class","tooltip").attr("id","barsTtip")}function updateBars(t){for(var e=[+dataset[t][0]["security+_holders"],+dataset[t][0].cissp_holders,+dataset[t][0].cipp_holders,+dataset[t][0].cisa_holders,+dataset[t][0].cism_holders,+dataset[t][0].giac_holders],a=[+dataset[t][0]["security+_openings"],+dataset[t][0].cissp_openings,+dataset[t][0].cipp_openings,+dataset[t][0].cisa_openings,+dataset[t][0].cism_openings,+dataset[t][0].giac_openings],i={labels:["CompTIA Security+","Certified Information Systems Security Professional (CISSP)","Certified Information Privacy Professional (CIPP)","Certified Information Systems Auditor (CISA)","Certified Information Security Manager (CISM)","GIAC certification"],series:[{label:"CompTIA Security+",holOp:[+dataset[t][0]["security+_holders"],+dataset[t][0]["security+_openings"]]},{label:"Certified Information Systems Security Professional (CISSP)",holOp:[+dataset[t][0].cissp_holders,+dataset[t][0].cissp_openings]},{label:"Certified Information Privacy Professional (CIPP)",holOp:[+dataset[t][0].cipp_holders,+dataset[t][0].cipp_openings]},{label:"Certified Information Systems Auditor (CISA)",holOp:[+dataset[t][0].cisa_holders,+dataset[t][0].cisa_openings]},{label:"Certified Information Security Manager (CISM)",holOp:[+dataset[t][0].cism_holders,+dataset[t][0].cism_openings]},{label:"GIAC certification",holOp:[+dataset[t][0].giac_holders,+dataset[t][0].giac_openings]}]},s=[],r=0;r<i.labels.length;r++)for(var n=0;n<i.series[0].holOp.length;n++)s.push(i.series[r].holOp[n]);var o=["CompTIA Security+ is the certification globally trusted to validate foundational, vendor-neutral IT security knowledge and skills. As a benchmark for best practices in IT security, this certification covers the essential principles for network security and risk management – making it an important stepping stone of an IT security career.","CISSP is an advanced security credential that demonstrates the technical and managerial competence, skills, experience, and credibility to design, engineer, implement, and manage information security programs.","CIPP demonstrates foundational understanding of global concepts of privacy and data protection laws and practice.","CISA demonstrates audit experience, skills, and knowledge, as well as the ability to assess vulnerabilities, report on compliance, and institute controls within an enterprise.","CISM is a management-focused certification that demonstrates the ability to manage the design, oversight, and assessment of an IT security program.","GIAC Certifications provide demonstrable assurance of cyber security knowledge and skills, offering more than 30 certifications to ensure mastery in critical, specialized InfoSec domains from entry-level to advanced job roles."],l=["Career Starter","Career Advancer","Career Advancer","Career Advancer","Career Advancer","Career Starter or Career Advancer"];x.domain([0,d3.max(s)]),y.domain(i.labels);var d=barSvg.selectAll("g.gi").data(i.series),c=d.enter().append("g").attr("class","gi").attr("transform",function(t){return"translate(0,"+y(t.label)+")"}),p=d.selectAll("g.bar").data(function(t){return t.holOp}),u=p.enter().append("g").attr("class",function(t,e){return e%2==0?" bar first":"bar second"}).attr("transform",function(t,e){return e%2==1?"translate("+margin.left+","+(e*barHeight+gapBetweenGroups*(.6+Math.floor(e/i.series.length)))+")":"translate("+margin.left+","+(e*barHeight+gapBetweenGroups*(.5+Math.floor(e/i.series.length)))+")"});u.append("rect").attr("fill",function(t,e){return color(e%i.series.length)}).attr("class","bar").attr("height",barHeight-1),u.append("text").attr("y",function(t,e){return e%2==1?20:-10}).attr("class","barNum").attr("dy",".35em").attr("fill",function(t,e){return color(e%i.series.length)}),c.append("text").attr("class","label").attr("x",function(){return 130}).attr("y",35).attr("dy",".45em").attr("text-anchor","end").style("cursor","default").text(function(t,e){return i.labels[e]}).call(wrap,130).on("mouseover",function(t,e){var a=this;d3.select("#barsTtip").html('<div class="level">Level: <strong>'+l[e]+'</strong></div><div class="descr">'+o[e]+"</div>").style("display","block").style("top",function(){var t=d3.transform(d3.select(a.parentNode).attr("transform")),e=t.translate[1],i=d3.select(a).node().getBBox(),s=d3.select(this).node().getBoundingClientRect();return console.log(i.height),220>e?e+i.height+30+"px":e-s.height+20+"px"})}).on("mouseout",function(){d3.select("#barsTtip").style("display","none")}),u.append("line").attr("class","barsLine").attr("x1",0).attr("y1",-4).attr("x2",width+margin.right/2).attr("y2",-4).attr("stroke","#CFD8DC").style("display",function(t,e){return e%2==0?"none":"block"}),u.append("circle").attr("class","barsCirc").attr("stroke","#CFD8DC").attr("cx",width+margin.right/2).attr("cy",-5).attr("r",23).attr("fill","#fff").style("display",function(t,e){return e%2==0?"none":"block"}),d3.selectAll(".barRatio").remove();var f=barSvg.selectAll("g.second");f.append("text").attr("class","barRatio").attr("x",width+margin.right/2).attr("text-anchor","middle").text(function(t,i){return 1==isFinite(e[i]/a[i])?formatDecimal(e[i]/a[i]):"N/A"});var h=p.selectAll("rect.bar");d3.selectAll("g.bar");h.transition().duration(500).attr("width",function(t,e,a){return x(0==isNaN(h[a].parentNode.__data__)?h[a].parentNode.__data__:5)}),p.selectAll("text.barNum").transition().duration(500).attr("x",0).text(function(t,e,a){return 0==isNaN(h[a].parentNode.__data__)?formatThousand(h[a].parentNode.__data__):"<10"}).attr("text-anchor","start");var g=y.domain(i.series.sort(function(t,e){return 1==isNaN(t.holOp[0])?e.holOp[0]/e.holOp[1]-0:1==isNaN(e.holOp[0])?0-t.holOp[0]/t.holOp[1]:e.holOp[0]/e.holOp[1]-t.holOp[0]/t.holOp[1]}).map(function(t){return t.label})).copy();d3.selectAll(".gi").transition().duration(500).attr("transform",function(t){return"translate(0,"+g(t.label)+")"})}function drawLegend(){var t=theMap.svg.append("g").attr("class","leg");mapW>600?t.attr("transform","translate("+theMap.width/1.2+","+theMap.height/2.35+")"):330>mapW?t.attr("transform","translate("+theMap.width/2.15+","+.09*theMap.height+")"):t.attr("transform","translate("+theMap.width/1.95+","+.09*theMap.height+")"),t.append("text").attr("class","legendVar").style("font-size",function(){return mapW>600?"12px":"11px"}).text("Total job postings").attr("transform","translate(0,-6)");var e=t.selectAll("g.legendEntry").data(quantile.range()).enter().append("g").attr("class","legendEntry");t.append("rect").attr("x",function(){return mapW>600?0:150}).attr("y",function(){return mapW>600?115:0}).attr("width",20).attr("height",10).attr("fill","#ddd").attr("class","noMsaR"),t.append("text").attr("y",function(){return mapW>600?115:15}).attr("x",function(){return mapW>600?33:159}).attr("dy","0.8em").attr("dx","-0.8em").attr("font-size","10px").attr("class","naTxt").text(function(){return mapW>600?"No MSA":"N/A"}).attr("class","noMsaT"),e.append("rect").attr("y",function(t,e){return mapW>600?16*e:0}).attr("x",function(t,e){return mapW>600?0:21*e}).attr("width",20).attr("height",10).attr("fill",function(t){return t}),e.append("text").attr("y",function(t,e){return mapW>600?16*e:15}).attr("x",function(t,e){return mapW>600?33:21*e}).attr("dy","0.8em").attr("dx","-0.8em").attr("font-size","10px").attr("class","legendTxt").text(function(t,e){return selectedVar=void 0==selectedVar?"total_postings":selectedVar,setLegendLabel(t,e)});var a=d3.select(".leg").node().getBBox();t.insert("rect",":first-child").attr("width",function(){return mapW>600?125:175}).attr("height",a.height+6).attr("y",a.y-3).attr("x",a.x-4).attr("rx",5).attr("ry",5).attr("fill","#fff")}function wrap(t,e){t.each(function(){for(var t,a=d3.select(this),i=a.text().split(/\s+/).reverse(),s=[],r=0,n=1.3,o=a.attr("y"),l=a.attr("x"),d=parseFloat(a.attr("dy")),c=a.text(null).append("tspan").attr("x",l).attr("y",o).attr("dy",d+"em");t=i.pop();)s.push(t),c.text(s.join(" ")),c.node().getComputedTextLength()>e&&(s.pop(),c.text(s.join(" ")),s=[t],c=a.append("tspan").attr("x",l).attr("y",o).attr("dy",++r*n+d+"em").text(t))})}function isBigEnough(t){return function(e){return e>=t}}var formatDecimal=d3.format(".3n"),formatDecimal2=d3.format(".2n"),formatThousand=d3.format(",d"),dataset,csvData,postingsArr=[],theTreeMap,theMap,rateByStateId,rateByMsaId,clickedId=0,quantile,selectedVar,mapW,storedCxStSd,storedCxMsaSd,storedCxStLq,storedCxMsaLq,heatMap=function(t){this.geo=t.geo,this.element=t.element,this.view=t.view,this.draw(),this.setView(),this.update()};heatMap.prototype.draw=function(){this.setDimensions(),this.svg=d3.select(this.element).append("svg"),this.element.style.width=this.width+"px",this.svg.attr("width",this.width),this.svg.attr("height",this.height),this.centered=null,this.isZoomed=!1,this.maxZoom=2.5,this.lineStroke=1,this.homeButton(),this.plot=this.svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")").attr("class","map-g"),this.plot.append("rect").attr("class","background").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height).on("click",function(e){var a=this;t.isZoomed&&t.clicked(e,a)}),this.tooltipDiv=d3.select(this.element).append("div").attr("class","tooltip"),this.resetProjection();for(var t=this,e=this.plot.append("g").attr("class","states-g"),a=e.selectAll("path").data(topojson.feature(this.geo,this.geo.objects.states).features).enter().append("path").attr("d",t.path).attr("class","state feature").attr("id",function(t){return"fips_"+t.id}),i=0;i<a[0].length;i++)a[0][i].__data__.centroidY=this.path.centroid(a[0][i].__data__)[1];a.sort(function(t,e){return d3.ascending(t.centroidY,e.centroidY)});for(var s=this.plot.append("g").attr("class","msas-g"),r=(s.selectAll("stateBckg").data(topojson.feature(this.geo,this.geo.objects.states).features).enter().append("path").attr("d",t.path).attr("class","stateBckg").attr("id",function(t){return"bgfips_"+t.id}).attr("fill","#dddddd").attr("stroke","#fff"),s.selectAll("msa").data(topojson.feature(this.geo,this.geo.objects.msa).features).enter().append("path").attr("d",t.path).attr("class",function(t){return"undefined"!=typeof dataset[t.properties.geoid]?+dataset[t.properties.geoid][0].population<25e4?"msa feature small":+dataset[t.properties.geoid][0].population>1e6?"msa feature large":"msa feature medium":void 0}).attr("id",function(t){return"fips_"+t.properties.geoid})),i=0;i<r[0].length;i++)r[0][i].__data__.centroidY=this.path.centroid(r[0][i].__data__)[1];r.sort(function(t,e){return d3.ascending(t.centroidY,e.centroidY)}),this.setListeners()},heatMap.prototype.setListeners=function(){var t=this;this.plot.selectAll(".feature").on("mouseover",function(e){1!=d3.select(this).classed("active")&&(d3.select(this).classed("active",!0).moveToFront(),d3.select("#fips_"+clickedId).moveToFront(),t.tooltip(e),t.tooltipDiv.style("display","block"))}).on("mouseout",function(){d3.select(this).classed("active",!1),t.tooltipDiv.style("display","none")}).on("mousemove",function(){var e=document.body.getBoundingClientRect(),a=t.element.getBoundingClientRect(),i=a.top-e.top,s=a.left-e.left,r=d3.event.pageX-s,n=d3.event.pageY-i,o=parseInt(t.tooltipDiv.style("width").replace("px",""),10),l=parseInt(t.tooltipDiv.style("height").replace("px",""),10),d=r-o/2,c=n-l-30,p=t.width-o/2;d+o/2>=p&&(d=p-o/2),0>c&&(c=n+30),0>d&&(d=0),t.tooltipDiv.style({top:c+"px",left:d+"px"})}).on("click",function(e){t.tooltipDiv.style("display","none");var a=this;updateTable(e),t.clicked(e,a)})},heatMap.prototype.setColor=function(t){return t?void 0:this.colors.blank},heatMap.prototype.resetProjection=function(){mapW>600?projectionRatio=1:projectionRatio=1.35,this.path=d3.geo.path(),this.projection=d3.geo.albersUsa().scale(this.width*projectionRatio).translate([this.width/2,this.height/2]),this.path.projection(this.projection)},heatMap.prototype.setDimensions=function(){this.width=this.element.offsetWidth,mapW>600?this.height=.46*this.element.offsetWidth:this.height=.76*this.element.offsetWidth,this.margin={top:0,right:0,bottom:0,left:0},600>mapW&&(this.margin.top=25)},heatMap.prototype.setView=function(){var t=this.plot.select(".states-g"),e=this.plot.select(".msas-g");"states"===this.view?(t.style("display","block"),e.style("display","none"),d3.selectAll(".coun").style("display","none"),d3.selectAll(".st").style("display","block"),d3.select("#supply_demand_ratioSvg").select(".avLine").attr("x1",function(t){return storedCxStSd(t.ratio)}).attr("x2",function(t){return storedCxStSd(t.ratio)}),d3.select("#supply_demand_ratioSvg").select(".avTxt").attr("x",function(t){return storedCxStSd(t.ratio)}),d3.select("#supply_demand_ratioSvg").select(".avNum").attr("x",function(t){return storedCxStSd(t.ratio)}),d3.select("#location_quotientSvg").select(".avLine").attr("x1",function(t){return storedCxStLq(t.ratio)}).attr("x2",function(t){return storedCxStLq(t.ratio)}),d3.select("#location_quotientSvg").select(".avTxt").attr("x",function(t){
return storedCxStLq(t.ratio)}),d3.select("#location_quotientSvg").select(".avNum").attr("x",function(t){return storedCxStLq(t.ratio)}),d3.selectAll(".legendTxt").text(function(t,e){return setLegendLabel(t,e)}),d3.select("#search").attr("placeholder","Search State"),d3.select(".filterBtns").style("display","none"),d3.selectAll(".noMsaR").style("display","none"),d3.selectAll(".noMsaT").style("display","none")):"msas"===this.view&&(t.style("display","none"),e.style("display","block"),d3.selectAll(".coun").style("display","block"),d3.selectAll(".st").style("display","none"),d3.select("#supply_demand_ratioSvg").select(".avLine").attr("x1",function(t){return storedCxMsaSd(t.ratio)}).attr("x2",function(t){return storedCxMsaSd(t.ratio)}),d3.select("#supply_demand_ratioSvg").select(".avTxt").attr("x",function(t){return storedCxMsaSd(t.ratio)}),d3.select("#supply_demand_ratioSvg").select(".avNum").attr("x",function(t){return storedCxMsaSd(t.ratio)}),d3.select("#location_quotientSvg").select(".avLine").attr("x1",function(t){return storedCxMsaLq(t.ratio)}).attr("x2",function(t){return storedCxMsaLq(t.ratio)}),d3.select("#location_quotientSvg").select(".avTxt").attr("x",function(t){return storedCxMsaLq(t.ratio)}),d3.select("#location_quotientSvg").select(".avNum").attr("x",function(t){return storedCxMsaLq(t.ratio)}),d3.selectAll(".legendTxt").text(function(t,e){return setLegendLabel(t,e)}),d3.select("#search").attr("placeholder","Search Metro Area"),d3.select(".filterBtns").style("display","block"),d3.selectAll(".noMsaR").style("display","block"),d3.selectAll(".noMsaT").style("display","block"))},heatMap.prototype.update=function(){this.setDimensions(),this.svg.attr("width",this.width),this.svg.attr("height",this.height),this.resetProjection(),d3.selectAll(".state").attr("d",this.path),d3.selectAll(".msa").attr("d",this.path),d3.selectAll(".stateBckg").attr("d",this.path),d3.select(".leg").attr("transform","translate("+this.width/1.2+","+this.height/2.35+")"),d3.select(".instr").attr("x",this.width/1.75).attr("y",.08*this.height)},heatMap.prototype.homeButton=function(){var t=this;d3.select(this.element).append("button").attr("class","home-btn").html("&minus; Zoom out").on("click",function(e){var a=this;t.isZoomed&&t.clicked(e,a)})},heatMap.prototype.clicked=function(t,e){var a,i,s;d3.selectAll(".feature").style("stroke-width","1px");var r=this;if("undefined"!=typeof t&&t.id)t&&r.centered!==t?(r.centered=t,r.isZoomed=!0,d3.selectAll(".feature").classed("clicked",!1),d3.selectAll(".feature").classed("active",!1),d3.select(e).moveToFront().classed("centered",!0).classed("clicked",!0).style("stroke-width","3px"),r.isZoomed=!0,clickedId=t.id):(r.centered=null,r.isZoomed=!1,d3.select(e).classed("clicked",!1),d3.selectAll(".feature").classed("clicked",!1),r.isZoomed=!1,clickedId=0,d3.select(".region").html("National level"),drawOpenings(0),d3.selectAll("circle.ratioCirc").style("opacity",.5).attr("stroke","none"),d3.selectAll(".ratioNumber").style("display","none"),d3.selectAll(".ratioState").style("display","none"),d3.selectAll(".cirG").select("rect").style("display","none"),d3.select("#cf0").moveToFront().style("opacity",1).attr("stroke","#455A64").attr("stroke-width","2px"),d3.select("#tf0").style("display","block"),d3.select("#tsf0").style("display","block"),fillTopJobs(0),theTreeMap.updateTreemap(0),updateBars(0),d3.selectAll(".qualText").text(""),d3.selectAll(".qualifiers").style("opacity",.4));else{if(t&&r.centered!==t){var n=r.path.centroid(t);a=n[0],i=n[1],s=r.maxZoom,r.centered=t,d3.selectAll(".feature").classed("clicked",!1),d3.select(e).moveToFront().classed("centered",!0).classed("clicked",!0).style("stroke-width","3px"),r.isZoomed=!0,clickedId="states"===r.view?t.id:t.properties.geoid,d3.select(".home-btn").style("display","block"),r.plot.selectAll(".feature:not(.clicked)").transition().duration(750).style("stroke-width",r.lineStroke/2+"px"),d3.select(".instruction").style("display","none"),r.plot.selectAll(".stateBckg").transition().duration(750).style("stroke-width",r.lineStroke/2+"px")}else a=r.width/2,i=r.height/2-r.margin.top,s=1,r.centered=null,d3.select(e).classed("centered",!1),d3.selectAll(".feature").classed("clicked",!1),r.isZoomed=!1,clickedId=0,d3.select(".home-btn").style("display","none"),r.setListeners(),d3.select(".region").html("National level"),drawOpenings(0),d3.selectAll("circle.ratioCirc").style("opacity",.5).attr("stroke","none"),d3.selectAll(".ratioNumber").style("display","none"),d3.selectAll(".ratioState").style("display","none"),d3.selectAll(".cirG").select("rect").style("display","none"),d3.select("#cf0").moveToFront().style("opacity",1).attr("stroke","#455A64").attr("stroke-width","2px"),d3.select("#tf0").style("display","block"),d3.select("#tsf0").style("display","block"),fillTopJobs(0),theTreeMap.updateTreemap(0),updateBars(0),d3.select(".instruction").style("display","block"),d3.selectAll(".qualText").text(""),d3.selectAll(".qualifiers").style("opacity",.4),r.plot.selectAll(".feature").transition().duration(750).style("stroke-width",r.lineStroke+"px"),r.plot.selectAll(".stateBckg").transition().duration(750).style("stroke-width",r.lineStroke+"px");r.plot.classed("zoomed",r.isZoomed),r.zoomScale(s,a,i)}},heatMap.prototype.zoomScale=function(t,e,a){console.log(a);var i=this;i.plot.transition().duration(750).attr("transform","translate("+i.width/2+","+i.height/2+")scale("+t+")translate("+-e+","+-a+")")},heatMap.prototype.tooltip=function(t){var e,a=document.getElementById("drpdn"),i=a.options[a.selectedIndex].text;if(selectedVar=a.options[a.selectedIndex].value,"states"===this.view){var s;s="total_postings"==selectedVar||"total_supply"==selectedVar?formatThousand(+dataset[t.id][0][selectedVar]):formatDecimal(+dataset[t.id][0][selectedVar]),e='<div class="tipStateName"> '+t.properties.state+"</div>",e+='<div class="tipVarName"> '+i+"</div>",e+='<div class="tipVar"> '+s+"</div>"}else if("msas"===this.view){var s;s="total_postings"==selectedVar||"total_supply"==selectedVar?formatThousand(+dataset[t.properties.geoid][0][selectedVar]):formatDecimal(+dataset[t.properties.geoid][0][selectedVar]),e='<div class="tipStateName"> '+t.properties.NAME+"</div>",e+='<div class="tipVarName"> '+i+"</div>",e+='<div class="tipVar"> '+s+"</div>",e+="<div class='more'>&#9432; Click for more info</div>"}d3.select(".tooltip").html(e)},heatMap.prototype.reDraw=function(){var t=this;switch(selectedVar){case"total_postings":quantile.range(colorbrewer.PuBu[7]);break;case"total_supply":quantile.range(["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"]);break;case"supply_demand_ratio":quantile.range(["#2166ac","#5586bd","#7fa7cf","#fef0d9","#faa078","#d75231","#990000"]);break;case"location_quotient":quantile.range(colorbrewer.BuPu[5])}csvData.forEach(function(t){t.fips.toString().length<3&&0!=t.fips?rateByStateId.set(+t.fips,+t[selectedVar]):t.fips.toString().length>3&&0!=t.fips&&rateByMsaId.set(+t.fips,+t[selectedVar])});var e=[0,.67,.83,1.2,1.5,8];d3.selectAll(".feature").transition().duration(500).delay(function(e,a){return"msas"==t.view?1*a:5*a}).attr("fill",function(t){if(t.id){if("supply_demand_ratio"==selectedVar){var a=rateByStateId.values().filter(isBigEnough(1.01));quantile.domain(a);var i=[0,.5,.99,1,quantile.invertExtent(quantile.range()[4])[0],quantile.invertExtent(quantile.range()[5])[0],quantile.invertExtent(quantile.range()[6])[1]];return quantile.domain(i),quantile(rateByStateId.get(t.id))}return"location_quotient"==selectedVar?(quantile.domain(e),quantile(rateByStateId.get(t.id))):(quantile.domain(rateByStateId.values()),quantile(rateByStateId.get(t.id)))}if("undefined"!=typeof t.properties){if("supply_demand_ratio"==selectedVar){var a=rateByMsaId.values().filter(isBigEnough(1.01));quantile.domain(a);var i=[0,.5,.99,1,quantile.invertExtent(quantile.range()[4])[0],quantile.invertExtent(quantile.range()[5])[0],quantile.invertExtent(quantile.range()[6])[1]];return quantile.domain(i),quantile(rateByMsaId.get(t.properties.geoid))}return"location_quotient"==selectedVar?(quantile.domain(e),quantile(rateByMsaId.get(t.properties.geoid))):(quantile.domain(rateByMsaId.values()),quantile(rateByMsaId.get(t.properties.geoid)))}return"#fff"}),d3.select(".leg").remove(),drawLegend();var a=document.getElementById("drpdn"),i=a.options[a.selectedIndex].text;d3.select(".legendVar").text(i)},init("public_data"),$("input.dataK").on("click",function(){var t=document.getElementById("prelC");t.style.display="block";var e=document.getElementById("con");e.style.opacity="0.1";var a=$(this).attr("val");$(".map").empty(),$(".supply_demand_qualifier").empty(),$("#supply_demand_ratioChart").empty(),$(".location_quotient_qualifier").empty(),$("#location_quotientChart").empty(),$(".treemap").empty(),$(".barChart").empty(),init(a+"_data")});var qualifierData=["Very Low","Low","Average","High","Very High"],treemapData,treeMap=function(t){this.element=t.element,this.createTreemap(t.fips),this.initialize(t.treeMapData),this.layout(t.treeMapData),this.display(t.treeMapData)};treeMap.prototype.createTreemap=function(){this.tooltipDiv=d3.select(this.element).append("div").attr("class","treeTooltip tooltip"),this.margin={top:0,right:5,bottom:10,left:5},this.width=d3.select(".no5").select(".boxContent").node().getBoundingClientRect().width-(this.margin.left+this.margin.right),this.height=.68*this.width-this.margin.top-this.margin.bottom,this.formatNumber=d3.format(",.1f"),this.x=d3.scale.linear().domain([0,this.width]).range([0,this.width]),this.y=d3.scale.linear().domain([0,this.height]).range([0,this.height]),this.treemap=d3.layout.treemap().children(function(t,e){return e?null:t._children}).sort(function(t,e){return t.size-e.size}).ratio(this.height/this.width*(1+Math.sqrt(5))).round(!1).value(function(t){return t.size}),this.svg=d3.select(".treemap").append("svg").attr("width",this.width+this.margin.left+this.margin.right).attr("height",this.height+this.margin.bottom+this.margin.top).style("margin-left",-this.margin.left+"px").style("margin.right",-this.margin.right+"px").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")").style("shape-rendering","crispEdges"),this.g1=this.svg.append("g").attr("class","depth")},treeMap.prototype.initialize=function(t){function e(t){return(t._children=t.children)?t.size=0:t.size}t.x=0,t.y=5,t.dx=this.width,t.dy=this.height,t.depth=0,e(t)},treeMap.prototype.layout=function(t){t._children&&(this.treemap.nodes({_children:t._children}),t._children.forEach(function(e){e.x=t.x+e.x*t.dx,e.y=t.y+e.y*t.dy,e.dx*=t.dx,e.dy*=t.dy,e.parent=t}))},treeMap.prototype.display=function(t){function e(){d3.select(".depth").selectAll("text").style("opacity",function(){var t=this.getBBox(),e=t.width,a=t.height,i=d3.select(this.parentNode).select(".child").attr("width")-10,s=parseFloat(d3.select(this.parentNode).select(".child").attr("height"));return i>e&&s>35?1:e>i||a>s||35>s?0:void 0})}var a=this,i=["#0472b4","#d0d1e6","#3690c0","#0570b0","#a6bddb","#f1eef6","#74a9cf"],s=this.g1.selectAll("g").data(t.children);s.enter().append("g").attr("rel",function(t,e){return e});var r=s.selectAll(".child").data(function(t){return[t]});r.enter().append("rect").attr("class","child").attr("fill",function(){var t=d3.select(this.parentNode).attr("rel");return i[t]}).call(this.rect,this).on("mouseover",function(t){a.tooltip(t),a.tooltipDiv.style("display","block")}).on("mousemove",function(){d3.selectAll("rect.child").style("stroke","#fff"),d3.select(this.parentNode).moveToFront(),d3.select(this).moveToFront().style("stroke","#034e7b").attr("stroke-width","2px"),d3.select(this.parentNode).selectAll("text").moveToFront();var t=document.body.getBoundingClientRect(),e=a.element.getBoundingClientRect(),i=e.top-t.top,s=e.left-t.left,r=d3.event.pageX-s,n=d3.event.pageY-i,o=parseInt(a.tooltipDiv.style("width").replace("px",""),10),l=parseInt(a.tooltipDiv.style("height").replace("px",""),10),d=r-o/2,c=n-l-30,p=a.width-o/2;d+o/2>=p&&(d=p-o/2),0>c&&(c=n+30),0>d&&(d=0),a.tooltipDiv.style({top:c+"px",left:d+"px"})}).on("mouseout",function(){d3.select(this.parentNode).select(".parent").moveToFront(),d3.select(this.parentNode).selectAll("text").moveToFront(),d3.select(this).style("stroke","#fff").attr("stroke-width","4px"),a.tooltipDiv.style("display","none")});var n=s.selectAll(".catName").data(function(t){return[t]});n.enter().append("text").attr("dy",".75em").attr("class","catName").text(function(t){return t.name});var o=s.selectAll(".overlaidText").data(function(t){return[t]});o.enter().append("text").classed("overlaidText",!0).text(function(t){return formatThousand(t.value)});var l=this.g1.transition().duration(500);l.selectAll("rect").call(this.rect,this),l.selectAll("text").text(function(t){return t.name}).call(this.text,this),l.selectAll(".overlaidText").text(function(t){return formatThousand(t.value)}).call(this.middletext,this),l.each("end",function(){e()})},treeMap.prototype.text=function(t,e){t.attr("x",function(t){return e.x(t.x)+8}).attr("y",function(t){return e.y(t.y)+8})},treeMap.prototype.middletext=function(t,e){t.attr("x",function(t){return e.x(t.x)+8}).attr("y",function(t){return e.y(t.y+t.dy)-10})},treeMap.prototype.rect=function(t,e){t.attr("x",function(t){return e.x(t.x)}).attr("y",function(t){return e.y(t.y)}).attr("width",function(t){return e.x(t.x+t.dx)-e.x(t.x)}).attr("height",function(t){return e.y(t.y+t.dy)-e.y(t.y)}).attr("rx","3px")},treeMap.prototype.updateTreemap=function(t){this.treeMapData={name:"Postings by NICE Framework Area",children:[{defs:"Specialty Areas responsible for providing the support, administration, and maintenance necessary to ensure effective and efficient information technology (IT) system performance and security.",name:"Operate & Maintain",size:+dataset[t][0].operate_maintain},{defs:"Specialty Areas responsible for conceptualizing, designing, and building secure information technology (IT) systems, with responsibility for some aspect of the systems' development.",name:"Securely Provision",size:+dataset[t][0].securely_provision},{defs:"Specialty Areas responsible for providing leadership, management, direction, or development and advocacy so the organization may effectively conduct cybersecurity work.",name:"Oversee & Govern",size:+dataset[t][0].oversight_development},{defs:"Specialty Areas responsible for specialized denial and deception operations and collection of cybersecurity information that may be used to develop intelligence.",name:"Collect & Operate",size:+dataset[t][0].collect_operate},{defs:"Specialty Areas responsible for highly specialized review and evaluation of incoming cybersecurity information to determine its usefulness for intelligence.",name:"Analyze",size:+dataset[t][0].analyze},{defs:"Specialty Areas responsible for identifying, analyzing, and mitigating threats to internal information technology (IT) systems or networks.",name:"Protect & Defend",size:+dataset[t][0].protect_defend},{defs:"Specialty Areas responsible for investigating cyber events or crimes related to information technology (IT) systems, networks, and digital evidence.",name:"Investigate",size:+dataset[t][0].investigate}]},this.initialize(this.treeMapData),this.treemap.sort(function(t,e){return t.size-e.size}),this.layout(this.treeMapData),this.display(this.treeMapData)},treeMap.prototype.tooltip=function(t){var e;e='<div class="tipAreaName"> '+t.name+"</div>",e+='<div class="subCat"> '+t.defs+" </div>",d3.select(".treeTooltip").html(e)};var barSvg,barHeight,gapBetweenGroups,margin,width,height,color,x,y,yAxis;d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;t&&this.parentNode.insertBefore(this,t)})};